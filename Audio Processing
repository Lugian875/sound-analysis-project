import tkinter as tk
from tkinter import filedialog, messagebox
import librosa
import soundfile as sf

# Audio processing function
def process_audio_file():
    # Select audio file
    audio_path = filedialog.askopenfilename(filetypes=[("Audio Files", "*.wav *.mp3 *.aac")])
    if not audio_path:
        messagebox.showwarning("No File Selected", "Please try again.")
        return

    try:
        # Convert if necessary?
        if not audio_path.endswith(".wav"):
            converted_path = audio_path.rsplit('.', 1)[0] + "_converted.wav"
            audio_data, sample_rate = librosa.load(audio_path, sr=None, mono=False)
            sf.write(converted_path, audio_data, sample_rate)
            audio_path = converted_path
            messagebox.showinfo("Conversion Done", f"File converted to WAV: {audio_path}")

        # Validate data
        audio_data, sample_rate = librosa.load(audio_path, sr=None)
        if audio_data.size == 0:
            raise ValueError("Selected audio file is empty.")
        messagebox.showinfo("Validation Success", "Audio file passed validation.")

        # Step 4: Remove metadata
        cleaned_path = audio_path.rsplit('.', 1)[0] + "_no_metadata.wav"
        sf.write(cleaned_path, audio_data, sample_rate)
        messagebox.showinfo("Metadata Removed", f"Metadata-free file saved: {cleaned_path}")

        # -> mono data to make storage and stuff simple
        mono_path = cleaned_path.rsplit('.', 1)[0] + "_mono_channel.wav"
        audio_data, sample_rate = librosa.load(cleaned_path, sr=None, mono=True)
        sf.write(mono_path, audio_data, sample_rate)
        messagebox.showinfo("Processing Complete", f"Mono file saved: {mono_path}")
    except Exception as e:
        messagebox.showerror("Error", f"Audio processing failed: {e}")

# GUI 
def start_gui():
    # Initialize root window
    root = tk.Tk()
    root.title("Acoustic Data Processing Tool")

    # Add a button to process the audio file
    process_button = tk.Button(root, text="Process Audio File", command=process_audio_file)
    process_button.pack(pady=20)

    # Start the main event loop
    root.mainloop()

# Start the GUI
if __name__ == "__main__":
    start_gui()
